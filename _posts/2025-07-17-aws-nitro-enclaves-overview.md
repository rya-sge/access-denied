```
layout: post
title: "AWS Nitro Enclaves: Secure and Isolated Compute for Sensitive Data"
date: 2025-07-17
lang: en
locale: en-GB
categories: security
tags: amazon enclave nitro secure-environement
description: AWS Nitro Enclaves, a feature of Amazon EC2,  aims to offer highly isolated and secure execution environments.
image: /assets/article/virtualization/amazon/nitro_enclaves_eks.png
isMath: false
```

As organizations increasingly migrate sensitive workloads to the cloud, ensuring data security during processing becomes a mission-critical challenge. 

**AWS Nitro Enclaves**, a feature of Amazon EC2,  aims to offer highly isolated and secure execution environments. These enclaves provide a trusted runtime for workloads such as cryptographic operations, personally identifiable information (PII) processing, and sensitive machine learning inference.

[TOC]

------

## What Are AWS Nitro Enclaves?

**Nitro Enclaves** are isolated, hardened virtual machines created from a **parent EC2 instance**. These environments are completely cut off from the network and inaccessible via SSH or other external interfaces. They have:

- **No persistent storage**
- **No external network connectivity**
- **No interactive access (not even for root users)**

The purpose of Nitro Enclaves is to **protect data in use**â€”a crucial, often overlooked component of cloud data security. By running applications in a trusted and isolated environment, Nitro Enclaves minimize the attack surface and guard against both external threats and insider risks.

Reference: [AWS - What is Nitro Enclaves?](https://docs.aws.amazon.com/enclaves/latest/user/nitro-enclave.html)

------

## Key Architectural Components

Nitro Enclaves are built on the **AWS Nitro System**, the same hypervisor that powers EC2, ensuring performance, security, and hardware-level isolation. Here's how the architecture works:

### ðŸ”¹ Parent Instance

A Nitro-based EC2 instance that hosts the enclave. It allocates dedicated vCPUs and memory for the enclave and is the only entity allowed to communicate with itâ€”via a secure local channel called **vsock**.

Reference: [Nitro Enclaves concepts - Parent instance](https://docs.aws.amazon.com/enclaves/latest/user/nitro-enclave-concepts.html#term-parent)

### ðŸ”¹ Enclave

The enclave is a separate VM with its own kernel, vCPUs, and memory. It is launched using an **Enclave Image File (.eif)**, which contains the OS, libraries, and enclave application. Once created, the enclave is isolated from both the parent instance and the external world.

### ðŸ”¹ Vsock (Virtual Socket)

Since thereâ€™s no network access, **vsock** serves as the only communication channel between the parent instance and its enclaves. It allows local inter-process communication in a secure and controlled way.

### ðŸ”¹ Nitro CLI & SDK

- **Nitro CLI**: Command-line interface used to create, manage, and terminate enclaves.
- **Nitro Enclaves SDK**: A developer toolkit to write enclave-aware applications and interact with services like **AWS KMS** using **attestation**.

------

## Security Features

### Cryptographic Attestation

A core security capability of Nitro Enclaves is **cryptographic attestation**, which allows an enclave to prove its identity and integrity. This is achieved via:

- **Attestation Document**: Generated by the Nitro Hypervisor, containing measurements like Platform Configuration Registers (PCRs) and other metadata.
- **PCRs**: Cryptographic hashes that verify the enclaveâ€™s code and environment havenâ€™t changed.

This attestation process is trusted by services like **AWS Key Management Service (KMS)**, enabling key access only when the enclave matches an approved configuration.

See [Cryptographic attestation](https://docs.aws.amazon.com/enclaves/latest/user/set-up-attestation.html).

###  KMS Integration (KMS proxy)

Nitro Enclaves integrate natively with **AWS KMS** to perform cryptographic operations (like key decryption or generation) **only** if the enclave passes attestation. 

The **KMS proxy**, running on the parent instance, securely proxies requests from the enclave to KMS.

See [KMS proxy - Nitro Enclaves concepts](https://docs.aws.amazon.com/enclaves/latest/user/nitro-enclave-concepts.html#term-proxy)

------

## Supported EC2 Instance Types

Nitro Enclaves are **processor-agnostic** and work on most **Intel, AMD, and AWS Graviton-based EC2 instances** built on the Nitro System.

### Requirements

- **Intel/AMD**: At least **4 vCPUs**
- **Graviton**: At least **2 vCPUs**
- **Linux-only** enclaves (parent instance can run Linux or Windows)

Some instance types (e.g., `t3`, `g5g`, `u-*`) are excluded. Also, Nitro Enclaves are not supported on **Outposts**, **Local Zones**, or **Wavelength Zones**.

------

## Properties

Here is the propreties of Nitro Enclaves

| Limitation                  | Description                                                  |
| --------------------------- | ------------------------------------------------------------ |
| No persistent storage       | Enclaves are ephemeral and lose all state after termination. |
| No network access           | They canâ€™t access AWS services directly; all communication must go through the parent instance. |
| No debugging/SSH            | Users cannot SSH into an enclave, and the data and applications inside the enclave cannot be accessed by the processes |
| Numbers of enclaves by host | Up to **four enclaves per instance**, and enclaves cannot talk to each otherâ€”even on the same host. |
| Parent instance dependency  | Enclave lifecycle is tied to the parent instance. If it stops, the enclave terminates. |
| Enclave OS restriction      | Enclaves support **Linux only**.                             |



------

## Use Cases

AWS Nitro Enclaves are ideal for workloads requiring **confidential computing** or **privacy-preserving operations**, including:

- **Processing and anonymizing PII and PHI**
- **Securing machine learning model inference**
- **Digital rights management**
- **Cryptographic signing and key management**
- **Regulated financial or healthcare applications**

------

## Related AWS Services

Nitro Enclaves integrate with several AWS services:

- **AWS Key Management Service (KMS)** â€“ for secure cryptographic operations tied to attestation.
- **AWS Certificate Manager (ACM)** â€“ for SSL/TLS certificate provisioning and management for applications running inside enclaves.

## Using Nitro enclaves with Amazon EKS

Amazon EKS can be used to **deploy, scale, and orchestrate Nitro Enclaves** from Kubernetes pods. By installing the **Nitro Enclaves Kubernetes device plugin** on EC2 instances (EKS nodes), pods on that node gain the ability to **create and manage enclaves** using the Nitro Enclaves CLI.

### Key Components:

- **Launch Template**: Must be enclave-enabled and include specific user data to configure enclave support. Used to create the enclave-enabled EKS nodes.
- **Kubernetes Device Plugin**: Enables pods to interact with enclaves. Compatible with both EKS-managed and self-managed Kubernetes nodes.

> **Note**: All pods on the same enclave-enabled node can communicate with the enclave on that node.

This setup allows Kubernetes users to integrate Nitro Enclaves into containerized workloads, enhancing data security for sensitive operations.

![nitro_enclaves_eks]({{site.url_complet}}/assets/article/virtualization/amazon/nitro_enclaves_eks.png)

Image reference: [docs.aws.amazon.com - kubernetes.html](https://docs.aws.amazon.com/enclaves/latest/user/kubernetes.html)



Reference: [docs.aws.amazon.com - Using Nitro Enclaves with Amazon EKS](https://docs.aws.amazon.com/enclaves/latest/user/kubernetes.html)



------

## Pricing

There is **no additional cost** to use Nitro Enclaves. You only pay for the **EC2 instance** and any other AWS services you use, such as KMS.

See [What is Nitro Enclaves? - pricing](https://docs.aws.amazon.com/enclaves/latest/user/nitro-enclave.html#nitro-enclave-pricing)

------

## Conclusion

**AWS Nitro Enclaves** offer a hardware-based solution for isolating and processing sensitive data, designed to meet security and compliance requirements in cloud environments. Through features such as **enclave isolation**, **cryptographic attestation**, and **integration with AWS services like KMS**, Nitro Enclaves enable the development of applications that require secure data handling.

For workloads that involve confidential data and demand strong security boundaries, Nitro Enclaves can be a suitable option within an overall cloud security strategy.

## Reference

- [docs.aws.amazon.com - What is Nitro Enclaves?](https://docs.aws.amazon.com/enclaves/latest/user/nitro-enclave.html)
- ChatGPT to summarize the documentation