---
layout: post
title:  Crypto wallet - What could go wrong ?
date:   2024-09-19
lang: en
locale: en-GB
categories: blockchain cryptography
tags: blockchain wallet
description: This article is an introduction to Multi-Party Computation (MPC)
image:  /assets/article/blockchain/solana/solanaLogoMark.png
isMath: false
---

Crypto wallets are a key piece of blockchain and crypto infrastructures. These software are generally responsible to:

- Generate seed phrase and associated private keys
- Store the private keys securely
- Provide a way to sign transactions, interact with applications (dApps), move the funds, ...

Several hacks and vulnerabilities are related to crypto wallets. This paper provides an eye about the main hacks and vulnerabilities, having affected known crypto wallets.

This paper does not consider vulnerabilities which target the user, e.g. to sign a malicious transaction. 

[TOC]



## Cryptography implementation

### Bad randomness

#### Bitcoin Randstorm

**Date:** 2011-2015, "discovered in 2023"

This vulnerability concerned wallets generated by BitcoinJS (and derivative projects) between 2011 - 2015. BitcoinJS was a popular package for the browser based generation of cryptocurrency wallets.

The source of the vulnerability is the SecureRandom() function found in the JavaScript Big Number ([JSBN](http://www-cs-students.stanford.edu/~tjw/jsbn/)) javascript library, combined with weaknesses that existed in major browser implementations of Math.random().

To obtain “high-quality” pseudo-random numbers, BitcoinJS used this library JSBN  until 2014, specifically its *SecureRandom* function.

This function was designed to generate pseudo-random numbers that qualify for use in cryptography. To increase their entropy, *SecureRandom* relies on the browser function *window.crypto.random*.

Unfortunataly, this function was not implemented in most of navigatore (only Netscape). As such, this call in JSBN fails silently when used by early versions of BitcoinJS and entropy is subsequently gathered from **Math.random()**, wich is not designed to produce secure random numbers.



Use a secure random function (SecureRandom() )

Generate pseudo-random numbers that qualify for use in cryptography.

Relies on the browser function *window.crypto.random*.

Only implemented in Netscape

Reference:

- [unciphered.com - Randstorm: You Can’t Patch a House of Cards](https://www.unciphered.com/blog/randstorm-you-cant-patch-a-house-of-cards)

- [unciphered.com - Randstorm](https://www.unciphered.com/randstorm)

- [Kaspersky - Randstorm: vulnerable crypto wallets from the 2010s](https://www.kaspersky.com/blog/vulnerability-in-hot-cryptowallets-from-2011-2015/49943/)



### MPC Bitforge vulnerability

**Date:**

**Impact:** zero, discovered by Fireblocks

The BitForge vulnerabilitis allows an attacker to potentially exfiltrate the full private key due to a missing zero-knowledge proof.

This vulnerability was present at the pseudo code level of the protocols GG-18 and GG-20, widely adopted by MPC wallet providers

Another vulnerability is the Lindell17 vulnerability, This one  originates from implementations deviating from the specification of the academic paper and mishandling failed signatures. The vulnerability  allows an attacker to exploit the party that finalizes the signing  process, either the wallet provider or user, to exfiltrate the key after approximately 200 signature requests.

According to CoinBase, a “malicious server inside Coinbase infrastructure” to trick users into  “initiating hundreds of fully authenticated signing requests.

Reference 

- [CoinDesk - Fireblocks Discloses ‘Zero Day’ Vulnerabilities Impacting Leading MPC Wallets](https://www.coindesk.com/tech/2023/08/09/fireblocks-discloses-zero-day-vulnerabilities-impacting-leading-mpc-wallets/)
- [BitForge: Fireblocks researchers uncover vulnerabilities in over 15 major wallet providers](https://www.fireblocks.com/blog/bitforge-fireblocks-researchers-uncover-vulnerabilities-in-over-15-major-wallet-providers/)
- [Fireblocks - Lindell17 Abort Vulnerability CVE-2023-33242 Technical Report](https://www.fireblocks.com/blog/lindell17-abort-vulnerability-technical-report)

### IOTA Bad Winternitz

**Date:**

**Impact:** zero, discovered by security researcher

At the beginning, IOTA used Winternitz as the main signature schema for their ledger (now ECsDA). Winternitz requires to use a hash function.

In their case, they decide to design their own hash function *Curl*. This hash function was vulnerable to collision attack through differential cryptanalysis according to security researchers.

For their PoC, these researchers  managed to produce two payments in IOTA which are different, but hash to the same value, and thus have the same signature. 

This attack could be used by a bad actor to destroy or steal users’ funds.

Reference: [Cryptographic vulnerabilities in IOTA](https://medium.com/@neha/cryptographic-vulnerabilities-in-iota-9a6a9ddc4367)

### Unfixable Seed Extraction on Trezor 

The Donjon recently found a physical attack on the Trezor One  hardware wallet, which has been responsibly disclosed to Trezor. The  identified vulnerability allows an attacker with physical access to get  the master seed protected by the wallet if no strong passphrase is set.  After a deep evaluation of this vulnerability, it appears very clearly  that this vulnerability cannot be patched without making a complete  hardware redesign of the hardware wallet. When we first talked about  this attack, it has been said that the attack was too specialized, not  realistic and hard to reproduce. At first, it required heavy and  expensive equipment (worth more than $100.000) with a complete day of  work for a hardware security expert. Note: this is the typical setup we  use for challenging the security of our own hardware wallets.



## Supply chain Attack

### Ledger Connect kit (2023)

[Ledger](https://www.ledger.com) is a family of hardware wallet

To connect the wallet to Dapps front-end, the company provides a software called Connect kit

On December 14th, 2023, an attacker managed to compromise the NPMJS accounts of a formal Ledger employee through phishing and use this access to deploy a malicious package instead of the official one. 

As a result, when a user signs a transaction on an affected dapp, the funds were rerouted to the attacker's wallet.

When this attack doesn't not affect directly the security of the hardware wallet, it demonstrates the importance to keep external library safe.

Reference: [ledger.com - A letter from Ledger Chairman & CEO Pascal Gauthier Regarding Ledger Connect Kit Exploit](https://www.ledger.com/blog/a-letter-from-ledger-chairman-ceo-pascal-gauthier-regarding-ledger-connect-kit-exploit), https://hacken.io/insights/ledger-hack-explained/ https://www.ledger.com/blog/security-incident-report

![img](https://cdn.prod.website-files.com/64ef149a1d50ae58a7c04212/657dfed1d65f297b75f26cb7_Screenshot%202023-12-16%20at%2021.47.19.png)

### IOTA Trinity wallet Hack (2020)

**Date:** 2020

**Impact:** Theft of 8.55 Ti in IOTA tokens.

Trinity is a software wallet for the IOTA digital asset that has been developed for desktop and mobile operating systems and managed by the IOTA Foundation.

Moonpay is a third-party service that allows users to purchase mIOTA tokens from within the Trinity wallet.

On February 12, 2020 the Trinity Wallet was attacked via a third-party dependency from Moonpay, which resulted in the theft of around 8.55 Ti in IOTA tokens.*

An attacker compromised with one of several illicit versions of Moonpay’s software development kit (SDK), which was being loaded automatically from Moonpay’s servers (their content delivery network) when a user opened Trinity. 

a. The code was loaded into the local Trinity instance

b. After the user’s wallet was unlocked, decrypted the user’s seed

c.  Sent the seed and password to a server controlled by the attacker. 

Before transferring tokens out, the attacker awaited the release of a new Trinity version, which would overwrite Trinity’s cache files and thus remove the remaining traces of the hacker

Reference:

- [blog.iota - Trinity Attack Incident Part 1: Summary and next steps](https://blog.iota.org/trinity-attack-incident-part-1-summary-and-next-steps-8c7ccc4d81e8/)

- [fullycrypto.com - IOTA Releases Comprehensive Trinity Wallet Hack Reports](https://fullycrypto.com/iota-releases-comprehensive-trinity-wallet-hack-reports)

### MyAlgo (2023)

The CDN API key linked to a particular account was potentially compromised, jeopardizing the account’s security. Exploiting the potentially compromised API key, a malicious actor introduced harmful JavaScript code into a web application via a specific worker of the CDN. The perpetrator extracted users’ confidential data, including private keys and mnemonics, by transmitting POST requests to a particular domain containing the acquired sensitive information. Consequently, the attacker managed to obtain users’ mnemonics and private keys by engaging with the compromised website, potentially enabling unauthorized access to users’ digital assets.

https://github.com/HalbornSecurity/PublicReports/blob/master/Incident%20Reports/RandLabs_MyAlgo_Wallet_Executive_Summary_Halborn%20.pdf

## Smart contract bug - Party wallet (2017)

**Date:** 2017

**Impact:** 150,000 ETH (~30M USD).

In 2017, an attacker exploited a critical vulnerability in the Parity multi-signature wallet to steal over $30 million worth of crypto, a wallet powered by smart contract on Ethereum. This vulnerability allowed the attacker to gain control of the wallet’s ownership and transfer funds to their own address.

Reference: [The Parity Wallet Hack Explained](https://blog.openzeppelin.com/on-the-parity-wallet-multisig-hack-405a8c12e8f7), [An In-Depth Look at the Parity Multisig Bug](https://hackingdistributed.com/2017/07/22/deep-dive-parity-bug/)



## Bad configuration

### Slope Wallet (2022)

> The Solana ecosystem appears to be the victim of crypto’s latest exploit, with users reporting their funds have been drained without their knowledge from major internet-connected “hot” wallets including Phantom, Slope and TrustWallet”.

On 2 August 2022, many Blockchain Solana users have found that their wallet has been completely drained of funds. 

During the hack, a lot of rumors emerged: Which wallets are affected? Is this a way out with Solana ?

Quickly, a culprit emerged: Slope wallet

After a more longer analysis,  several researchers found that the Slope crypo wallet leaked information about the seed phrase with the implementation of Sentry, a tool for logging events.

Slope’s mobile app sends off mnemonics via TLS to their centralized Sentry server.  These mnemonics are then stored in plaintext, meaning anybody with access to Sentry could access user private keys.

![](https://x.com/osec_io/status/1555087560887922688/photo/1)

This was notably confirmed by the security firm OtterSec.

Reference: [Ottersec tweet](https://x.com/osec_io/status/1555087560887922688?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1555087560887922688%7Ctwgr%5E853fa774d6163ab7cb03b5c9d01dbcade82d7131%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fdiscover.luno.com%2Fwhat-exactly-happened-in-the-slope-finance-hack%2F), [Slope Wallet Sentry Vulnerability — Digital Forensics and Incident Response Report](https://slope-finance.medium.com/slope-wallet-sentry-vulnerability-digital-forensics-and-incident-response-report-d7a5904e5a39)

## Code implementation 

### Breaking Trezor One with Side Channel Attacks

Publised on 2019 by Ledger Donjon, a Side Channel Attack on PIN verification allows an attacker with a stolen Trezor One to retrieve the correct value of the PIN within a few minutes.

The conclusion of their analysis is that it is possible to mount two profiled side-channel attacks on the device leading to

- The retrieval of the PIN code of a stolen device.

- the retrieval of significant portions of the scalar used during an elliptic curve point multiplication (which leads to a private key  recovery).

  
  
  The PIN verification function code extracted from the firmware source code is presented below:
  
  ![https://ledger-wp-website-s3-prd.ledger.com/uploads/2024/03/pincode.png](https://ledger-wp-website-s3-prd.ledger.com/uploads/2024/03/pincode.png)
  
  

In the funtion, two operations are sensitive to side channel attacks:

- The `storageRom->pin` digits are processed in the  function one-by-one in the main loop. This means, from a side-channel  point of view, that we can target each digit independently from the  others. This is called a Divide & Conquer strategy: instead of  attacking a N-digits PIN (9^N possible values), we mount N side-channel  attacks, each of them on a single digit (9 possible values for each  digit). They have worked on 4-digits PIN, but the attack can be  extended to any PIN size.
- There is a particular sensitive value depending on the secret that  looks interesting: the value, at each step of the while loop of the  subtraction: `storageRom->pin[i] — presented_pin[i] for 0 ≤ i < 4`. This sensitive value handles both the secret and the input value,  allowing a side-channel attacker to induce differentiability.

Reference: https://www.ledger.com/blog/Breaking-Trezor-One-with-SCA

## Reference

[medium - 5 Devastating Hacks That Show How Vulnerable Online Wallets Really Are](https://medium.com/ngrave/5-devastating-hacks-that-show-how-vulnerable-online-wallets-really-are-a7e015764b63)

## Draft

MyAlgo

https://twitter.com/myalgo_/status/1637910092245860354

Gatehub Crypto Wallet

https://cointelegraph.com/news/gatehub-crypto-wallet-data-breach-compromises-passwords-of-14m-users

Trezor

https://blog.ledger.com/Unfixable-Key-Extraction-Attack-on-Trezor

Unfixable Seed Extraction on Trezor - A practical and reliable attack

List of attack

https://www.appdome.com/dev-sec-blog/top-5-attacks-aimed-at-crypto-wallet-apps-and-how-to-solve-them/

Magic link :https://www.coindesk.com/tech/2023/02/24/crypto-wallet-firm-dfns-says-magic-links-have-critical-vulnerability/

https://www.certik.com/resources/blog/01iz10lvnaAIcuNZ2zNJqA-2022-year-in-review-crypto-wallet-security-incidents