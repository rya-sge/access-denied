# Malware introduction

When analysing malware, it is important to consider the following:

- Point of Entry (PoE) I.e. Was it through spam that our e-mail filtering missed and the user opened the attachment? Let's review our spam filters and train our users better for future prevention!

- What are the indicators that malware has even been executed on a machine? Are there any files, processes, or perhaps any attempt of "un-ordinary" communication?

- How does the malware perform? Does it attempt to infect other devices? Does it encrypt files or install anything like a backdoor / Remote Access Tool (RAT)?

- Most importantly - can we ultimately prevent and/or detect further infection?!



Despite the many variants of malware, attacks can generally be classified into two types: **Targeted** and **Mass Campaign**.

Targeted

A "Targeted" attack is just that - targeted. In most cases, malware attacks that occur this way are created for a specific purpose against a specific target. A great example of this type of purpose could be the [DarkHotel](https://www.kaspersky.co.uk/resource-center/threats/darkhotel-malware-virus-threat-definition) malware, whom is designed to steal information such as authentication details from government officials.

Mass Campaign

On the other hand, the "Mass Campaign" classification can be akin to many real life examples, and is the most common type of attacks. The entire purpose of this type of Malware is to infect as many devices as possible and perform whatever it may - regardless of target.

Companies such as Kaspersky to name one, track these campaigns (known as Advanced Persistent Threats (APTs) and often report on their infection rate and indicators, much akin to the real-life spread of a virus from the World Health Organisation (WHO). 

Kaspersky [report on the "Crouching Yeti (Energetic Bear)" campaign](https://www.kaspersky.co.uk/resource-center/threats/crouching-yeti-energetic-bear-malware-threat), this campaign specifically targets the following:

- Industrial/machinery
- Manufacturing
- Pharmaceutical
- Construction
- Education
- Information technology

(Kaspersky)

Whilst it this variant is *technically* *targeted*, there is a rather large scope of this variant of malware, and as such, can be considered as a "Mass Campaign" attack.

https://tryhackme.com/room/malmalintroductory

Much like any interaction with an Operating System, there is always remnants of such activity even if there is little trace...

~~Un~~fortunately, **m****alware** (dependant on its variant) **is largely obtrusive** - in the sense that it leaves quite an extensive papertrail of evidence...Perfect for us analysers!

The ultimate process of a malware attack can be broken down into a few broad steps:

1. Delivery
2. Execution
3. Maintaining persistence (not always the case!)
4. Propagation (not always!)

**These steps will generate lots of data.** Namely: network traffic such as communicating with hosts, file system interaction like read/writes and modification.

Malware is essentially classified based upon the behaviours it produces to perform the steps listed above. For a famous example, Wannacry performs all four of these steps.

ï»¿1. Delivery

This could be of many methods, to name a few: USB (Stuxnet!), PDF attachments through "Phising" campaigns or vulnerability enumeration.

\2. Execution

Here's the main part of how we classify Malware. What does it actually do? If it encrypts files - it's Ransomware! If it records information like keystrokes or displays adware - we can classify it as Spyware.

**We only understand this stage through analysing the sample, which is why analysis is important - and is what we'll be covering.**

\3. Maintaining Persistence

It wouldn't make much sense for Malware authors to go through all the trouble of developing a piece of code that is capable of execution - just for it to execute and that's it...Gone. Unless you have a very specific agenda ([Cerber](https://blog.malwarebytes.com/detections/ransom-cerber/)).

I have submitted an extensive report on this specific Malware, amongst others for a University Module on Malware Analysis...however I will wait for it to be marked before sharing. 

Imagine a keylogger has been installed, but you then restart your Computer 30 seconds later. Unless you've entered a lot of sensitive information in 30 seconds - that'll be of no use to the author.

\4. Persistence

This stage is largely why Malware is so **"noisy"**, Malware employs many techniques, of which we'll be covering in-depth much later on. Essentially, this stage is just to make sure that the "execution" is worth its while.

\5. Propagation

Hey...If you can infect one device, why not infect more whilst you're at it? Again, this is another reason why Malware can be so noticeable. Host discovery generates a lot of network traffic, we'll come to this later.

**In Summary, there are two categories of fingerprints that malware may leave behind on a Host after an attack:**

Host-Based Signatures

These are generally speaking the results of execution and any persistence performed by the Malware. For example, has a file been encrypted? Has any additional software been installed? These are two of many, many host-based signatures that are useful to know to prevent and check against further infection.

Network-Based Signatures

At an overview, this classification of signatures are the observation of any networking communication taking place during delivery, execution and propagation. For example, in Ransomware, where has the Malware contacted for Bitcoin payments?

Such as in the case of Wannacry, looking for a large amount of "Samba" Protocol communication attempts is a great indication of infection due to its use of ["Eternalblue"](https://research.checkpoint.com/2017/eternalblue-everything-know/).



There are two categories used when analysing malware, these are:

\1. Static Analysis

\2. Dynamic Analysis

Whilst the methods and tools used for these two categories are vastly different, they are essential in compositing an understanding of how a malware behaves.

Static Analysis.

At its brief, "Static Analysis" is used to gain a high-level abstraction of the sample - it can be fairly simple to decide if a piece of code is "malicious" or not with this method alone (but not always, this will be discussed later...). At its core, this method is of the analysis of the sample at the state it presents itself as, without executing the code.

Employing the use of techniques such as signature analysis via checksums means quick, efficient (albeit extremely brief) and safe analysis of malware.

Dynamic Analysis

This step is a lot more involved, and is where the abstraction of the sample is largely built upon. "Dynamic Analysis" essentially involves executing the sample and observing what happens. This of course is not safe. If the sample turns out to be "Ransomware" - you've now lost your files. If it is capable of propagating via traversing a network, nice...You've now just infected your Local Area Network (LAN).

**Please note that these are extremely simplistic explanations of these techniques**, there is a lot more involved which we will go throughout this series.



## FAQ

### Malware compaign

>  What is the famous example of a targeted attack-esque Malware that targeted Iran?

Stuxnet

> What is the name of the Ransomware that used the Eternalblue exploit in a "Mass Campaign" attack?

Wannacry

### malware attack process

> Name the first essential step of a Malware Attack?

Delivery

> Now name the second essential step of a Malware Attack?

Execution

> What type of signature is used to classify remnants of infection on a host?

Host-Based Signatures

> What is the name of the other classification of signature used after a Malware attack?

Network-Based Signatures